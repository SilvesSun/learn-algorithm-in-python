# åºåˆ—åŒ–äºŒå‰æ ‘çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å‰åºéå†ã€‚å½“æˆ‘ä»¬é‡åˆ°ä¸€ä¸ªéç©ºèŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®°å½•ä¸‹è¿™ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ ‡è®°å€¼è®°å½•ï¼Œä¾‹å¦‚ #ã€‚
#
#       _9_
#     /   \
#    3     2
#   / \   / \
#  4   1  #  6
# / \ / \   / \
# # # # #   # #
#
#
#  ä¾‹å¦‚ï¼Œä¸Šé¢çš„äºŒå‰æ ‘å¯ä»¥è¢«åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸² "9,3,4,#,#,1,#,#,2,#,6,#,#"ï¼Œå…¶ä¸­ # ä»£è¡¨ä¸€ä¸ªç©ºèŠ‚ç‚¹ã€‚
#
#  ç»™å®šä¸€ä¸²ä»¥é€—å·åˆ†éš”çš„åºåˆ—ï¼ŒéªŒè¯å®ƒæ˜¯å¦æ˜¯æ­£ç¡®çš„äºŒå‰æ ‘çš„å‰åºåºåˆ—åŒ–ã€‚ç¼–å†™ä¸€ä¸ªåœ¨ä¸é‡æ„æ ‘çš„æ¡ä»¶ä¸‹çš„å¯è¡Œç®—æ³•ã€‚
#
#  æ¯ä¸ªä»¥é€—å·åˆ†éš”çš„å­—ç¬¦æˆ–ä¸ºä¸€ä¸ªæ•´æ•°æˆ–ä¸ºä¸€ä¸ªè¡¨ç¤º null æŒ‡é’ˆçš„ '#' ã€‚
#
#  ä½ å¯ä»¥è®¤ä¸ºè¾“å…¥æ ¼å¼æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¾‹å¦‚å®ƒæ°¸è¿œä¸ä¼šåŒ…å«ä¸¤ä¸ªè¿ç»­çš„é€—å·ï¼Œæ¯”å¦‚ "1,,3" ã€‚
#
#  ç¤ºä¾‹ 1:
#
#  è¾“å…¥: "9,3,4,#,#,1,#,#,2,#,6,#,#"
# è¾“å‡º: true
#
#  ç¤ºä¾‹ 2:
#
#  è¾“å…¥: "1,#"
# è¾“å‡º: false
#
#
#  ç¤ºä¾‹ 3:
#
#  è¾“å…¥: "9,#,#,1"
# è¾“å‡º: false
#  Related Topics æ ˆ æ ‘ å­—ç¬¦ä¸² äºŒå‰æ ‘
#  ğŸ‘ 350 ğŸ‘ 0


# leetcode submit region begin(Prohibit modification and deletion)
class Solution:
    def isValidSerialization(self, preorder: str) -> bool:
        """
        æ ˆçš„æ€è·¯æ˜¯ã€Œè‡ªåº•å‘ä¸Šã€çš„æƒ³æ³•ã€‚ä¸‹é¢è¦ç»“åˆæœ¬é¢˜æ˜¯ã€Œå‰åºéå†ã€è¿™ä¸ªé‡è¦ç‰¹ç‚¹ã€‚

        æˆ‘ä»¬çŸ¥é“ã€Œå‰åºéå†ã€æ˜¯æŒ‰ç…§ã€Œæ ¹èŠ‚ç‚¹-å·¦å­æ ‘-å³å­æ ‘ã€çš„é¡ºåºéå†çš„ï¼Œåªæœ‰å½“æ ¹èŠ‚ç‚¹çš„æ‰€æœ‰å·¦å­æ ‘éå†å®Œæˆä¹‹åï¼Œæ‰ä¼šéå†å³å­æ ‘ã€‚å¯¹äºæœ¬é¢˜çš„è¾“å…¥ï¼Œ
        æˆ‘ä»¬å¯ä»¥å…ˆåˆ¤æ–­ã€Œå·¦å­æ ‘ã€æ˜¯å¦æœ‰æ•ˆçš„ï¼Œç„¶åå†åˆ¤æ–­ã€Œå³å­æ ‘ã€æ˜¯å¦æœ‰æ•ˆçš„ï¼Œæœ€ååˆ¤æ–­ã€Œæ ¹èŠ‚ç‚¹-å·¦å­æ ‘-å³å­æ ‘ã€æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ã€‚
        è¿™ä¸ªæ€è·¯ç±»ä¼¼äºé€’å½’ï¼Œè€ŒæŠŠé€’å½’æ”¹å†™æˆå¾ªç¯æ—¶ï¼Œå°±ä¼šä½¿ç”¨ã€Œæ ˆã€ï¼Œè¿™å°±æ˜¯æœ¬é¢˜ä½¿ç”¨ã€Œæ ˆã€çš„åŸå› ã€‚

        å¦‚ä½•åˆ¤æ–­ä¸€æ£µå­æ ‘æ˜¯å¦æœ‰æ•ˆï¼Ÿé¦–å…ˆè€ƒè™‘æœ€ç®€å•æƒ…å†µï¼šæ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Ÿå¾ˆæ˜æ˜¾ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸¤ä¸ªå­©å­éƒ½æ˜¯ "#"ï¼ˆç©ºï¼‰çš„æ—¶å€™ï¼Œè¯¥èŠ‚ç‚¹å°±æ˜¯å¶å­èŠ‚ç‚¹ã€‚

        å½“ä¸€ä¸ªèŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹çš„æ—¶å€™ï¼Œé‚£ä¹ˆå®ƒå¿…å®šè‡³å°‘æœ‰ä¸€ä¸ªå­©å­éç©ºï¼æœ‰ä¸¤ç§æƒ…å†µï¼š

        ä¸¤ä¸ªå­©å­éƒ½é"#"ï¼ˆç©ºï¼‰ï¼›
        ä¸€ä¸ªå­©å­ä¸º"#"ï¼ˆç©ºï¼‰ï¼Œå¦ä¸€ä¸ªå­©å­é"#"ï¼ˆç©ºï¼‰

        ä¸ºäº†å…¼å®¹è¿™ä¸¤ä¸ªæƒ…å†µï¼Œæˆ‘ä»¬æƒ³å‡ºäº†æœ¬é¢˜çš„ä¸€ä¸ªé‡ç£…çº§çš„æŠ€å·§ï¼šæŠŠæœ‰æ•ˆçš„å¶å­èŠ‚ç‚¹ä½¿ç”¨ "#" ä»£æ›¿ã€‚ æ¯”å¦‚æŠŠ 4## æ›¿æ¢æˆ # ã€‚æ­¤æ—¶ï¼Œå¶å­èŠ‚ç‚¹ä¼šå˜æˆç©ºèŠ‚ç‚¹ï¼
        """
        stack = []
        for node in preorder.split(','):
            stack.append(node)
            while len(stack) >= 3 and stack[-1] == stack[-2] == '#' and stack[-3] != '#':
                [stack.pop() for _ in range(3)]
                stack.append('#')
        return len(stack) == 1 and stack == ['#']
